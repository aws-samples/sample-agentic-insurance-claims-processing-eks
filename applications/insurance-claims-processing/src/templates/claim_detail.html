<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claim Review - {{ claim.claim_id }}</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>

<body>
    <nav class="navbar">
        <div class="container navbar-content">
            <div class="brand">
                <span>üõ°Ô∏è</span> Agentic Insurance
            </div>
            <a href="/adjuster" class="btn btn-secondary">‚Üê Back to Dashboard</a>
        </div>
    </nav>

    <div class="main-content container">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 2rem;">
            <div>
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                    <h1>Claim {{ claim.claim_id }}</h1>
                    <span class="badge badge-info">{{ claim.status.replace('_', ' ').title() }}</span>
                </div>
                <p class="text-muted">Submitted on {{ claim.created_at.strftime('%Y-%m-%d %H:%M') if claim.created_at
                    else 'N/A' }}</p>
            </div>

            <div style="text-align: right;">
                <div class="text-muted" style="font-size: 0.875rem; margin-bottom: 0.25rem;">Estimated Amount</div>
                <div style="font-size: 2rem; font-weight: 700; color: var(--primary-color);">${{
                    "{:,.2f}".format(claim.claim_amount) }}</div>
            </div>
        </div>

        <div class="dashboard-grid" style="grid-template-columns: 2fr 1fr;">
            <!-- Left Column: Claim Details -->
            <div>
                <div class="card animate-fade-in">
                    <h3>Incident Details</h3>
                    <div class="dashboard-grid">
                        <div class="form-group">
                            <span class="form-label text-muted">Policy Holder</span>
                            <div style="font-weight: 600;">{{ claim.customer_name }}</div>
                        </div>
                        <div class="form-group">
                            <span class="form-label text-muted">Policy Number</span>
                            <div style="font-weight: 600;">{{ claim.policy_number }}</div>
                        </div>
                        <div class="form-group">
                            <span class="form-label text-muted">Type</span>
                            <div style="font-weight: 600;">{{ claim.claim_type }}</div>
                        </div>
                        <div class="form-group">
                            <span class="form-label text-muted">Location</span>
                            <div style="font-weight: 600;">{{ claim.location.address }}, {{ claim.location.city }}</div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 1rem;">
                        <span class="form-label text-muted">Description</span>
                        <div
                            style="background: var(--background-color); padding: 1rem; border-radius: var(--radius-md);">
                            {{ claim.description }}
                        </div>
                    </div>
                </div>

                <!-- AI Agent Reasoning Chain -->
                <div class="card animate-fade-in delay-100">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>ü§ñ Agentic Reasoning Chain</h3>
                        <span class="badge badge-info">Multi-Agent System</span>
                    </div>

                    <div class="agent-chain" id="agent-chain">
                        <!-- Policy Agent -->
                        <div class="agent-step">
                            <div class="agent-icon">üìÑ</div>
                            <div class="agent-content">
                                <h4>Policy Validation Agent</h4>
                                <p>Verified policy <strong>{{ claim.policy_number }}</strong> is active.</p>
                                <p class="text-muted" style="font-size: 0.875rem;">Coverage limits confirmed.
                                    Deductible: $500.</p>
                            </div>
                        </div>

                        <!-- Fraud Agent -->
                        <div class="agent-step">
                            <div class="agent-icon">üîç</div>
                            <div class="agent-content">
                                <h4>Fraud Detection Agent</h4>
                                {% set fraud_score = (claim.ai_recommendation or {}).get('fraud_score', 0) %}
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span>Risk Assessment</span>
                                    {% if fraud_score > 0.7 %}
                                    <span class="badge badge-danger">High Risk ({{ "{:.2f}".format(fraud_score)
                                        }})</span>
                                    {% else %}
                                    <span class="badge badge-success">Low Risk ({{ "{:.2f}".format(score) }})</span>
                                    {% endif %}
                                </div>
                                <p class="text-muted" style="font-size: 0.875rem; margin-top: 0.5rem;">
                                    Analyzed historical patterns and location data.
                                </p>
                            </div>
                        </div>

                        <!-- Coordinator Agent -->
                        <div class="agent-step">
                            <div class="agent-icon">üß†</div>
                            <div class="agent-content">
                                <h4>Coordinator Agent</h4>
                                <p>Synthesized results from all agents.</p>
                                <div
                                    style="background: #f0f9ff; padding: 0.5rem; border-radius: var(--radius-sm); margin-top: 0.5rem; color: #0369a1; font-weight: 500;">
                                    Recommendation: {{ (claim.ai_recommendation or {}).get('recommended_action',
                                    'Review').upper() }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Action Panel -->
            <div>
                <div class="card animate-fade-in delay-200" style="position: sticky; top: 100px;">
                    <h3>Adjudication</h3>

                    <div class="alert"
                        style="background: #fffbeb; color: #92400e; padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1.5rem; border: 1px solid #fcd34d;">
                        <strong>AI Recommendation:</strong><br>
                        {{ (claim.ai_recommendation or {}).get('compliance_note', 'Please review carefully.') }}
                    </div>

                    <form action="/adjuster/claim/{{ claim.claim_id }}/decision" method="post">
                        <input type="hidden" name="adjuster_id" value="ADJ001">

                        <div class="form-group">
                            <label class="form-label">Decision</label>
                            <select name="decision" class="form-control" required>
                                <option value="">-- Select Decision --</option>
                                <option value="approve">‚úÖ Approve Claim</option>
                                <option value="deny">‚ùå Deny Claim</option>
                                <option value="investigate">üîç Request Investigation</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Settlement Amount ($)</label>
                            <input type="number" name="settlement_amount" class="form-control"
                                value="{{ claim.claim_amount }}" step="0.01">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Reasoning Notes</label>
                            <textarea name="reasoning" class="form-control" rows="4" required
                                placeholder="Enter your justification..."></textarea>
                        </div>

                        <button type="submit" class="btn btn-primary" style="width: 100%;">Submit Decision</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/main.js"></script>
</body>

</html>